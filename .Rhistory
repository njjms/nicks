source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
source('~/Documents/panorama/pano_thermocycler/binom_diff_ci.R', echo=TRUE)
setwd("~/Documents/panorama/high_risk_dnn/hr_dnn_validation_analysis")
blinded_data_arm1 <- read_csv("hr_dnn_results_arm1.csv")
blinded_data_arm2 <- read_csv("hr_dnn_results_arm2.csv")
head(blinded_data_arm1)
sum(complete.cases(blinded_data_arm1))
blinded_data_arm1$noCallReason
blinded_data_arm1$pano_final_call
table(blinded_data_arm1$pano_final_call)
colnames(blinded_data_arm1)
table(blinded_data_arm1$clinical_truth)
table(blinded_data_arm1$clinical_truth,
blinded_data_arm1$pano_final_call)
colnames(blinded_data_arm1)
blinded_data_arm1 %>%
filter(blinded_case_id == 9500780)
blinded_data_arm1 %>%
filter(blinded_case_id == 9500780) %>%
select(clinical_truth, pano_final_call)
table(blinded_data_arm1$clinical_truth,
blinded_data_arm1$pano_final_call)
table(blinded_data_arm1$clinical_truth)
# Overall calls
table(blinded_data_arm1$clinical_truth,
blinded_data_arm1$pano_final_call)
209/12760
216/12760
# Specificity calculation
blinded_data_arm1 %>%
filter(blinded_case_id %in% c(9500780, 8249902)) %>%
select(clinical_truth, pano_final_call)
# Overall calls - 12544 calls for specificity, 11 calls for sensitivity
# 270 NCs for specificity, 1 NO_RESULT for sensitivity
table(blinded_data_arm1$clinical_truth,
blinded_data_arm1$pano_final_call)
# Overall calls - 12544 calls for specificity, 11 calls for sensitivity
# 270 NCs for specificity, 1 NO_RESULT for sensitivity
table(blinded_data_arm1$clinical_truth,
blinded_data_arm1$pano_final_call)
specificity_total_calls <- 12531 + 13
specificity_total_calls
#
# Arm 2 Analysis
#
blinded_data_arm2
#
# Arm 2 Analysis
#
blinded_data_arm2 %>%
filter(!is.na(blinded_case_id))
#
# Arm 2 Analysis
#
colnames(blinded_data_arm2)
#
# Arm 2 Analysis
#
blinded_data_arm2 %>%
filter(!is.na(blinded_case_id)) %>%
select(clinical_truth, pano_final_call)
#
# Arm 2 Analysis
# Edge cases:
#   -
blinded_data_arm2 %>%
filter(!is.na(blinded_case_id)) %>%
select(blinded_case_id, clinical_truth, pano_final_call)
#
# Sensitivity calculation
# Edge cases:
#   - 9712596 is a confirmed partial deletion
blinded_data_arm1 %>%
filter(clinical_truth == "22q Positive")
#
# Sensitivity calculation
# Edge cases:
#   - 9712596 is a confirmed partial deletion
blinded_data_arm1 %>%
filter(blinded_data_arm1 == 9712596)
#
# Sensitivity calculation
# Edge cases:
#   - 9712596 is a confirmed partial deletion
blinded_data_arm1 %>%
filter(blinded_data_arm1 == 9712596) %>%
select(pano_final_call)
#
# Sensitivity calculation
# Edge cases:
#   - 9712596 is a confirmed partial deletion
colnames(blinded_data_arm1)
blinded_data_arm1 %>%
filter(blinded_data_arm1 == 9712596) %>%
select(noCallReason, autocall, pano_digeorge_call)
#
# Sensitivity calculation
# Edge cases:
#   - 9712596 is a confirmed partial deletion
colnames(blinded_data_arm1)
blinded_data_arm1 %>%
filter(blinded_data_arm1 == 9712596) %>%
View()
#
# Arm 2 Analysis
# Edge cases:
#   - 9712596 was previously run on Pano V2 and was not salvageable
blinded_data_arm2 %>%
filter(!is.na(blinded_case_id)) %>%
select(blinded_case_id, clinical_truth, pano_final_call)
clopper_pearson(x=10, n=11, conf.level=.9)
clopper_pearson(x=10, n=sensitivity_total_calls, conf.level=.9)
specificity_total_calls <- 12531 + 13
sensitivity_total_calls <- 11
clopper_pearson(x=10, n=sensitivity_total_calls, conf.level=.9)
# Overall calls - 12544 calls for specificity, 11 calls for sensitivity
# 270 NCs for specificity, 1 NO_RESULT for sensitivity
table(blinded_data_arm1$clinical_truth,
blinded_data_arm1$pano_final_call)
specificity_total_calls
clopper_pearson(x=12531, n=specificity_total_calls, conf.level=.90)
clopper_pearson(x=12531, n=specificity_total_calls, conf.level=.95)
clopper_pearson(x=12531, n=specificity_total_calls-2, conf.level=.90)
#
# Specificity calculation
# Edge cases:
#   - 9500780 has a confirmed partial deletion 409kb (< 500kB)
#   - 8249902 mother may have had deletion (potential exclusion)
blinded_data_arm1 %>%
filter(blinded_case_id %in% c(9500780, 8249902)) %>%
select(clinical_truth, pano_final_call)
#
# Specificity calculation
# Edge cases:
#   - 9500780 has a confirmed partial deletion 409kb (< 500kB)
#   - 8249902 mother may have had deletion (potential exclusion)
blinded_data_arm1 %>%
filter(blinded_case_id %in% c(9500780, 8249902)) %>%
select(noCallReason, clinical_truth, pano_final_call)
#
# Specificity calculation
# Edge cases:
#   - 9500780 has a confirmed partial deletion 409kb (< 500kB)
#   - 8249902 mother may have had deletion (potential exclusion)
blinded_data_arm1 %>%
filter(blinded_case_id %in% c(9500780, 8249902)) %>%
select(clinical_truth, pano_final_call)
10/11
12760-270
# Overall calls - 12544 calls for specificity, 11 calls for sensitivity
# 270 NCs for specificity, 1 NO_RESULT for sensitivity
table(blinded_data_arm1$clinical_truth,
blinded_data_arm1$pano_final_call)
12760-217
12760-216
12760-218
12531/12542
# Column names
colnames(blinded_data_arm1)
# Overall calls - 12544 calls for specificity, 11 calls for sensitivity
# 216 NCs for specificity, 1 NO_RESULT for sensitivity
table(blinded_data_arm1$clinical_truth,
blinded_data_arm1$pano_final_call)
specificity_total_calls <- 12531 + 11
sensitivity_total_calls <- 11
blinded_data_arm1 %>%
filter(pano_final_call == "NO_CALL_QC_FAILURE")
blinded_data_arm1 %>%
filter(pano_final_call == "NO_CALL_QC_FAILURE") %>%
select(noCallReason)
# Column names
colnames(blinded_data_arm1)
blinded_data_arm1 %>%
filter(pano_final_call == "NO_CALL_QC_FAILURE") %>%
select(QC_exclusion)
blinded_data_arm1 %>%
filter(pano_final_call == "NO_CALL_QC_FAILURE") %>%
select(QC_exclusion) %>%
table()
blinded_data_arm1 %>%
filter(pano_final_call == "NO_CALL_QC_FAILURE") %>%
select(QC_exclusion) %>%
table() %>% sum
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL_QC_FAILURE", "NO_CALL")) %>%
select(QC_exclusion) %>%
table() %>% sum
# Overall calls - 12544 calls for specificity, 11 calls for sensitivity
# 216 NCs for specificity, 1 NO_RESULT for sensitivity
table(blinded_data_arm1$clinical_truth,
blinded_data_arm1$pano_final_call)
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL_QC_FAILURE", "NO_CALL"))
# Overall calls - 12544 calls for specificity, 11 calls for sensitivity
# 216 NCs for specificity, 1 NO_RESULT for sensitivity
table(blinded_data_arm1$clinical_truth,
blinded_data_arm1$pano_final_call)
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL_QC_FAILURE", "NO_CALL")) %>%
select(QC_exclusion)
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL_QC_FAILURE", "NO_CALL")) %>%
select(QC_exclusion) %>%
table() %>% sum
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL_QC_FAILURE", "NO_CALL")) %>%
select(QC_exclusion) %>%
table()
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL_QC_FAILURE")) %>%
select(QC_exclusion) %>%
table()
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL_QC_FAILURE")) %>%
select(QC_exclusion) %>%
table() %>% sum
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL_QC_FAILURE")) %>%
select(QC_exclusion) %>%
table()
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL_QC_FAILURE")) %>%
select(QC_exclusion) %>%
table() %>% sort()
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL")) %>%
select(QC_exclusion)
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL")) %>%
select(QC_exclusion) %>%
table() %>% sort()
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL_QC_FAILURE")) %>%
select(QC_exclusion) %>%
table() %>% sort()
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("LOW_FETAL_FRACTION")) %>%
select(blinded_case_id)
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("LOW_FETAL_FRACTION")) %>%
select(blinded_case_id) %>% collapse(., ",")
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("LOW_FETAL_FRACTION")) %>%
select(blinded_case_id) %>% paste(, collapse = ",")
?paste
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("LOW_FETAL_FRACTION")) %>%
select(blinded_case_id) %>% paste(., collapse = TRUE)
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("LOW_FETAL_FRACTION")) %>%
select(blinded_case_id) %>% paste(., collapse = ",")
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("LOW_FETAL_FRACTION")) %>%
pull(blinded_case_id) %>% paste(., collapse = ",")
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL_QC_FAILURE")) %>%
select(QC_exclusion) %>%
table() %>% sort()
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("INSUFFICIENT_DNA_NOR")) %>%
pull(blinded_case_id) %>% paste(., collapse = ",")
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL_QC_FAILURE")) %>%
select(QC_exclusion) %>%
table() %>% sort()
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("SAMPLE_CONTAMINATED")) %>%
pull(blinded_case_id) %>% paste(., collapse = ",")
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("FAILED_POST_ALIGNMENT_ERROR_RATE")) %>%
pull(blinded_case_id) %>% paste(., collapse = ",")
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("TRACER_FAILURE")) %>%
pull(blinded_case_id) %>% paste(., collapse = ",")
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("STATS_NO_CALL_OTHER_SINGLE_CHROM")) %>%
pull(blinded_case_id) %>% paste(., collapse = ",")
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("STATS_NO_CALL_OTHER")) %>%
pull(blinded_case_id) %>% paste(., collapse = ",")
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("LAB_ERROR")) %>%
pull(blinded_case_id) %>% paste(., collapse = ",")
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("FAILED_HOST_GENDER")) %>%
pull(blinded_case_id) %>% paste(., collapse = ",")
blinded_data_arm1 %>%
filter(QC_exclusion %in% c("LAB_ERROR")) %>%
pull(blinded_case_id) %>% paste(., collapse = ",")
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL")) %>%
select(QC_exclusion) %>%
table() %>% sort()
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL")) %>%
select(blinded_case_id, QC_exclusion)
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL")) %>%
pull(blinded_case_id)
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL")) %>%
pull(blinded_case_id) %>%
paste(., collapse=",")
blinded_data_arm1 %>%
filter(pano_final_call %in% c("NO_CALL_RE_PCR")) %>%
pull(blinded_case_id) %>%
paste(., collapse=",")
#
# Sensitivity calculation
# Edge cases:
#   - 9712596 was previously run on Pano V2 and was not salvageable
clopper_pearson(x=10, n=sensitivity_total_calls, conf.level=.9)
sensitivity_total_calls
#
# Sensitivity calculation
# Edge cases:
#   - 9712596 was previously run on Pano V2 and was not salvageable
clopper_pearson(x=10, n=sensitivity_total_calls, conf.level=.9)
blinded_data_arm1 %>%
filter(clinical_truth == "22q Positive")
blinded_data_arm1 %>%
filter(clinical_truth == "22q Positive") %>%
select(blinded_case_id,
depthofread,
QC_CFE,
hr_dnn_pos_confidence,
deletion_size,
deletion_source)
View(blinded_data_arm1)
blinded_data_arm1 %>%
filter(clinical_truth == "22q Positive") %>%
select(blinded_case_id,
depthofread,
QC_CFE,
hr_dnn_pos_confidence,
deletion_size,
deletion_source) %>%
write.csv(., "sens_analysis_hr_dnn_output.csv")
#
# Specificity calculation
# Edge cases:
#   - 9500780 has a confirmed partial deletion 409kb (< 500kB)
#   - 8249902 mother may have had deletion (potential exclusion)
clopper_pearson(x=12531, n=specificity_total_calls-2, conf.level=.90)
specificity_total_calls
# Overall calls - 12544 calls for specificity, 11 calls for sensitivity
# 216 NCs for specificity, 1 NO_RESULT for sensitivity
table(blinded_data_arm1$clinical_truth,
blinded_data_arm1$pano_final_call)
#
# Specificity calculation
# Edge cases:
#   - 9500780 has a confirmed partial deletion 409kb (< 500kB)
#   - 8249902 mother may have had deletion (potential exclusion)
clopper_pearson(x=12531, n=specificity_total_calls-2, conf.level=.90)
clopper_pearson(x=12530, n=specificity_total_calls-2, conf.level=.90)
clopper_pearson(x=12525, n=specificity_total_calls-2, conf.level=.90)
clopper_pearson(x=12520, n=specificity_total_calls-2, conf.level=.90)
clopper_pearson(x=12522, n=specificity_total_calls-2, conf.level=.90)
clopper_pearson(x=12521, n=specificity_total_calls-2, conf.level=.90)
# Overall calls - 12544 calls for specificity, 11 calls for sensitivity
# 216 NCs for specificity, 1 NO_RESULT for sensitivity
table(blinded_data_arm1$clinical_truth,
blinded_data_arm1$pano_final_call)
specificity_total_calls <- 12531 + 13
sensitivity_total_calls <- 11
#
# Specificity calculation
# Edge cases:
#   - 9500780 has a confirmed partial deletion 409kb (< 500kB)
#   - 8249902 mother may have had deletion (potential exclusion)
clopper_pearson(x=12531, n=specificity_total_calls-2, conf.level=.90)
blinded_data_arm3 <- read_csv("hr_dnn_results_arm3.csv")
View(blinded_data_arm3)
#
# Arm 3 Analysis
#
blinded_data_arm3
#
# Arm 3 Analysis
#
table(blinded_data_arm3$final_call)
#
# Arm 3 Analysis
#
table(blinded_data_arm3$final_call)/(sum(table(blinded_data_arm3$final_call))-1)
#
# Arm 3 Analysis
#
table(blinded_data_arm3$final_call)
#
# Arm 3 Analysis
#
table(blinded_data_arm3$final_call)/(1+38+7+2)
(38+7)/(38+7+3)
#
# Arm 3 Analysis
#
table(blinded_data_arm3$final_call)
(38+7)/(38+7+3)
(38+7+10)/(38+7+3+11) # Overall sensitivity point estimate 93.75%
#
# Specificity calculation
# Edge cases:
#   - 9500780 has a confirmed partial deletion 409kb (< 500kB)
#   - 8249902 mother may have had deletion (potential exclusion)
clopper_pearson(x=12531, n=specificity_total_calls-2, conf.level=.90)
sensitivity_estimate <- (38+7+10)/(38+7+3+11) # Overall sensitivity point estimate 93.22%
specificity_estimate <- 12531/(specificity_total_calls-2)
specificity_estimate
prevalence <- .0005
ppv_estimate <- (sensitivity_estimate*prevalence)/(sensitivity_estimate*prevalence + (1 - specificity_estimate)*(1-prevalence))
ppv_estimate
specificity_estimate
#
# Arm 3 Analysis
#
table(blinded_data_arm3$final_call)
clopper_pearson(x=45, n=48, conf.level=.9)
45/48
55/59
prevalence*2000
ppv_estimate <- (sensitivity_estimate*prevalence)/(sensitivity_estimate*prevalence + (1 - specificity_estimate)*(1-prevalence))
ppv_estimate
#
# Arm 3 Analysis
#
table(blinded_data_arm3$final_call)
clopper_pearson(x=45, n=48, conf.level=.9)
ppv_estimate <- (sensitivity_estimate*prevalence)/((sensitivity_estimate*prevalence) + (1 - specificity_estimate)*(1-prevalence))
ppv_estimate
data.frame(x = rnorm(50),
y = rep(1, 50))
data <- data.frame(x = rnorm(50),
y = rep(1, 50))
example_glmod <- glm(y ~ x, data = data,
family = "binomial")
example_glmod
dat1 <- data.frame(x = rnorm(50),
y = rep(1, 50))
example_glmod <- glm(y ~ x, data = dat1,
family = "binomial")
example_glmod
summary(example_glmod)
table(blinded_data_arm3$pano_digeorge_call,
blinded_data_arm3$final_call)
clopper_pearson(x=10, n=sensitivity_total_calls, conf.level=.95)
216/12760
specificity_total_calls-2
#
# Specificity calculation
# Edge cases:
#   - 9500780 has a confirmed partial deletion 409kb (< 500kB)
#   - 8249902 mother may have had deletion (potential exclusion)
clopper_pearson(x=12531, n=specificity_total_calls-2, conf.level=.90)
clopper_pearson(x=12531, n=specificity_total_calls-2, conf.level=.95)
12531/12542
#
# Arm 3 Analysis
#
table(blinded_data_arm3$final_call)
#
# Arm 2 Analysis
# Edge cases:
#   - 9712596 was previously run on Pano V2 and was not salvageable
View(blinded_data_arm2)
#
# Arm 3 Analysis
#
table(blinded_data_arm3$final_call)
#
# Arm 3 Analysis
#
sum(table(blinded_data_arm3$final_call))
12531/12542
12530/12542
12529/12542
clopper_pearson(x=508, n=508, conf.level=.95)
clopper_pearson(x=18022, n=18032, conf.level=.95)
wilson_score(x=18022, n=18032, conf.level=.95)
library(PropCIs)
exactci(x = 18022, n = 18032, conf.level=.95)
exactci(x=508, n=508, conf.level=.95)
17974/18003
exactci(x=17974, n = 18003, conf.level=.95)
prq_delta = .95
is.na(prq_delta)
interval_surpasses = TRUE
intercal_surpasses & is.na(prq_delta)
interval_surpasses & is.na(prq_delta)
interval_surpasses & !is.na(prq_delta)
if(interval_surpasses & !is.na(prq_delta)) print("hi")
prq_delta = NA
is.na(prq_delta)
shiny::runApp('~/Documents/power_calculator/power_calculator')
