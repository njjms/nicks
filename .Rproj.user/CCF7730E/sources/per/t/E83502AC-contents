getRversion()
set.seed(100)
available_blind_ids <- 8000000:9999999

# 500 SMART Negative Sampling
smart_negs <- read.csv("negative smart cases for phase0 val.csv")
smart_negs_sampled_cases <- sample(smart_negs$CaseID, 500, replace=FALSE)
smart_negs_idx <- sample(1:length(available_blind_ids), 500, replace=FALSE)
smart_negs_blinded_caseids <- available_blind_ids[smart_negs_idx]
available_blind_ids <- available_blind_ids[-smart_negs_idx]

# Arm 1a+1b 
arm1 <- read.csv("Arm1_validation_manifest.csv")
colnames(arm1)
non_portofino_cases <- arm1[!grepl("Portofino", arm1$Category),]
arm1_idx <- sample(1:length(available_blind_ids), 
				   nrow(non_portofino_cases), 
				   replace=FALSE)
arm1_blinded_caseids <- available_blind_ids[arm1_idx]
available_blind_ids <- available_blind_ids[-arm1_idx]

# Arm 2
arm2 <- read.csv("Arm2_validation_manifest.csv")
colnames(arm2)
arm2_idx <- sample(1:length(available_blind_ids), 
				   nrow(arm2), 
				   replace=FALSE)
arm2_blinded_caseids <- available_blind_ids[arm2_idx]

# Double check for no collisions
intersect(arm2_blinded_caseids, arm1_blinded_caseids)
intersect(smart_negs_blinded_caseids, arm1_blinded_caseids)

# Output the CSVs
write.csv(data.frame(CaseID = smart_negs_sampled_cases,
					 blindID = smart_negs_blinded_caseids), "smart_negs_blindids.csv")
write.csv(data.frame(CaseID = non_portofino_cases$Case.ID,
					 blindID = arm1_blinded_caseids), "Arm1_blindids.csv")
write.csv(data.frame(CaseID = arm2$Case.ID,
					 blindID = arm2_blinded_caseids), "Arm2_blindids.csv")
